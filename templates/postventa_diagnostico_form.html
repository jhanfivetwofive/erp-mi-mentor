{% extends "base.html" %}
{% block title %}Diagnóstico Postventa{% endblock %}
{% block content %}
<div class="container mt-4">
  <div class="card shadow-sm">
    <div class="card-header bg-success text-white d-flex align-items-center">
      <h5 class="mb-0">Diagnóstico Postventa</h5>
      <span class="ms-auto">Calificación: <strong id="scoreTotal">0</strong></span>
    </div>
    <div class="card-body">
      {% if error %}<div class="alert alert-warning">{{ error }}</div>{% endif %}
      <form method="post" class="row g-3">
        <div class="col-md-6">
          <label class="form-label">¿Cuál es tu nombre completo?</label>
          <input name="nombre" class="form-control" required>
        </div>
        <div class="col-md-3">
          <label class="form-label">¿Cuál es tu Teléfono/Celular?</label>
          <input name="telefono" class="form-control" required>
        </div>
        <div class="col-md-3">
          <label class="form-label">¿Cuál es tu Correo?</label>
          <input name="correo" type="email" class="form-control" required>
        </div>
        <div class="col-md-3">
          <label class="form-label">Número de Generación</label>
          <input name="generacion" class="form-control" placeholder="ej. 3 o G-03" required>
        </div>
        <div class="col-md-3">
          <label class="form-label">Estatus de Venta</label>
          <select name="estatus_venta" class="form-select">
            <option value="0">0 — En proceso / No compra</option>
            <option value="1">1 — Compra / Cierre</option>
          </select>
        </div>

        <div class="col-12">
          <hr>
        </div>

        {% for key, q in preguntas.items() %}
        <div class="card mb-3">
            <div class="card-header">
            <strong>{{ q.texto }}</strong> <span class="badge bg-secondary">{{ key }}</span>
            </div>
            <div class="card-body">
            <div class="row row-cols-1 row-cols-md-3 g-3">
                {% for val, label in q.opciones %}
                <div class="col">
                <div class="form-check">
                    <input class="form-check-input" type="radio" name="{{ key }}" id="{{ key }}_{{ val }}" value="{{ val }}" required
                        {% if request.form.get(key) == val %}checked{% endif %}>
                    <label class="form-check-label" for="{{ key }}_{{ val }}">
                    <span class="fw-semibold">{{ val }}</span> – {{ label }}
                    </label>
                </div>
                </div>
                {% endfor %}
            </div>
            </div>
        </div>
        {% endfor %}


        <div class="col-12 d-flex gap-2 mt-3">
          <button type="submit" class="btn btn-success">Guardar</button>
          <a href="{{ url_for('postventa_diagnostico_list') }}" class="btn btn-outline-secondary">Ver listado</a>
        </div>
      </form>
    </div>
  </div>
</div>
<script>
  function updateScore() {
    let total = 0;
    document.querySelectorAll('input[type=radio]:checked').forEach(r => {
      const v = parseInt(r.value, 10);
      if ([1, 2, 3].includes(v)) total += v;
    });
    document.getElementById('scoreTotal').textContent = total;
  }
  document.querySelectorAll('input[type=radio]').forEach(r => r.addEventListener('change', updateScore));
</script>
{% endblock %}