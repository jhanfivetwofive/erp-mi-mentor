{% extends "base.html" %}
{% block title %}Registrarse - Mi Mentor{% endblock %}

{% block content %}
<div class="login-container">
    <div class="login-logo">
        <img src="{{ url_for('static', filename='images/logo_mimentor.jpg') }}" alt="Logo Mi Mentor">
    </div>
    <div class="login-header">Crear cuenta</div>
    <form onsubmit="registerWithFirebase(event)">
        <div class="form-group">
            <label for="nombre">Nombre</label>
            <input type="text" id="nombre" class="form-control" placeholder="Tu nombre completo" required>
        </div>
        <div class="form-group mt-3">
            <label for="correo">Correo</label>
            <input type="email" id="correo" class="form-control" required>
        </div>
        <div class="form-group mt-3">
            <label for="password">Contraseña</label>
            <input type="password" id="password" class="form-control" required>
        </div>
        <button type="submit" class="btn login-button">Registrarse</button>
    </form>
</div>
{% endblock %}

{% block scripts %}
<script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-auth.js"></script>

<script>
  const firebaseConfig = {
    apiKey: "{{ firebase_api_key }}",  // Lo cargas como secreto
    authDomain: "mimentorerp.firebaseapp.com",
    projectId: "mimentorerp"
  };
  const app = firebase.initializeApp(firebaseConfig);

  async function registerWithFirebase(event) {
    event.preventDefault();
    const email = document.getElementById("correo").value;
    const password = document.getElementById("password").value;
    const nombre = document.getElementById("nombre").value;

    try {
      const userCredential = await firebase.auth().createUserWithEmailAndPassword(email, password);
      const idToken = await userCredential.user.getIdToken();

      const response = await fetch("/register_firebase", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ idToken, nombre })
      });

      const data = await response.json();
      if (response.ok) {
        alert("Usuario creado con éxito");
        window.location.href = "/alumnos";
      } else {
        alert("Error: " + data.error);
      }
    } catch (error) {
      alert("Firebase error: " + error.message);
    }
  }
</script>
{% endblock %}
